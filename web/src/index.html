<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <title>Hello, world!</title>
  </head>
  <body class="">
  	<div class="container">
		<h3>
			Nmap Output
			<small class="text-muted">With faded secondary text</small>
		</h3>  

		<div class="row">
			<nav class="navbar-expand-lg navbar-light bg-light" aria-label="breadcrumb">
				<ol class="breadcrumb">
					<li class="breadcrumb-item"><a href="#">Home</a></li>
					<li class="breadcrumb-item"><a href="#">Library</a></li>
					<li class="breadcrumb-item active" aria-current="page">Data</li>
				</ol>
			</nav>
		</div>
		
		<div class="row mt-3">
			<div class="input-group mb-3">
				<div class="input-group-prepend">
				  <span class="input-group-text api-url" id="basic-addon3">/get/nmap/pingsweep</span>
				</div>
				<input type="text" value="127.0.0.1" class="form-control api-target" id="basic-url" aria-describedby="basic-addon3">
				<button class="btn btn-primary api-run" type="button" id="button-addon2">Run</button>
			</div>
		</div>

		<div class="row mt-3">
			<div id="results">

			</div>

			<ul id="dataList"></ul>
			<div class="templates">
			  <div id="listItem">
				<div class="row1">
				  <div class="title"></div>
				  <div class="amount"></div>
				</div>
				<div class="row2"><div class="description"></div></div>
			  </div>
			</div>
		</div>
	</div>

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
	
	<script type="text/javascript">
		var JBSCount = 0; // JSON Button Set Counter

		$(".api-run").on("click", function(e)
		{
			var domain = "http://localhost:8008"
			var url = $(this).closest(".input-group").find(".api-url").text();
			var target = $(this).closest(".input-group").find(".api-target").val();

			console.log("[api-url] : " + url);
			console.log("[api-target] : " + target);

			$.ajax({
				url: domain + url,
				type: "get",
				data: { 
					target: target,
				},
				success: function(response) {
					console.log(response);
					
					$("#results").html(jsonToList(JSON.parse(response)));

				},
				error: function(xhr) {
					console.log(xhr);
				}
			});    
		});

		function jsonToList(obj) 
		{
			if (obj instanceof Array) {
				var ol = document.createElement('ol');
				for (var child in obj) {
					var li = document.createElement('li');
					li.appendChild(jsonToList(obj[child]));
					ol.appendChild(li);
				}
				return ol;
			}
			else if (obj instanceof Object && !(obj instanceof String)) {
				var ul = document.createElement('div');
				ul.classList.add("list-group")

				for (var child in obj) {
					var li = document.createElement('div');
					li.classList.add("list-group-item")
					li.appendChild(document.createTextNode(child + ": "));
					li.setAttribute("data-row-name", child);
					li.appendChild(jsonToList(obj[child]));
					
					// Show and hide labels for each JSON Button Set
					li.innerHTML += `
						<div class='btn-group float-end' role='group'>
						<input type='radio' class='btn-check' name='JBS-` + JBSCount + `' id='JBS-SHOW-` + JBSCount + `' autocomplete='off' checked>
						<label class='btn btn-outline-primary' for='JBS-SHOW-` + JBSCount + `'>Show</label>

						<input type='radio' class='btn-check' name='JBS-` + JBSCount + `' id='JBS-HIDE-` + JBSCount + `' autocomplete='off'>
						<label class='btn btn-outline-primary' for='JBS-HIDE-` + JBSCount + `'>Hide</label>
						</div>`;
					ul.appendChild(li);

					JBSCount++;
				}
				return ul;
			}
			else {
				return document.createTextNode(obj);
			}
		}
	</script>
</body>
</html>